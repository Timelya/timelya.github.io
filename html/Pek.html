<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <title>SZOP gy. - 25/26 I.: Zárthelyidolgozat</title>
    <script defer src="../js/nav.js"></script>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="../favicon.ico">
  </head>

  <body>
    <div class="page">
      <h1>Pékség</h1>

      <!-- 5 KÓDBLOKK -->
      <div class="codebox">
        <div class="code-title">Producer.cs</div>
        <pre class="code"><code>
public void Work()
{
    // Kiegészitendő
    IsWorking = true;

    while (productCount < amountToProduce)
    {
        Sutemeny sutemeny = new Sutemeny(termeltSutemenyFajta, termeltToltelek);

        if (Supervisor.TryProduce(this, sutemeny))
        {
            productCount++;
            Console.WriteLine($"{this} előállította: {sutemeny}");
        }

        Thread.Sleep(new Random().Next(1200, 1800));
    }

    IsWorking = false;
}
  </code></pre>
      </div>

      <div class="codebox">
        <div class="code-title">Consumer.cs</div>
        <pre class="code"><code>
public void Work()
{
    // Kiegészitendő
    IsWorking = true;

    while (Supervisor.areConsumersRunning)
    {
        if (Supervisor.TryConsume(this, out Sutemeny sutemeny))
        {
            Console.WriteLine($"{this} elfogyasztotta: {sutemeny}");
        }

        Thread.Sleep(new Random().Next(700, 1500));
    }

    IsWorking = false;
}
  </code></pre>
      </div>

      <div class="codebox">
        <div class="code-title">Supervisor.cs – TryProduce</div>
        <pre class="code"><code>
public static bool TryProduce(Producer producer, Sutemeny sutemeny)
{
    // Kiegészitendő
    lock (sutemenyek)
    {
        if (sutemenyek.Count >= maxSutemenyAPufferben)
            return false;

        sutemenyek.Add(sutemeny);
        return true;
    }
}
  </code></pre>
      </div>

      <div class="codebox">
        <div class="code-title">Supervisor.cs – TryConsume</div>
        <pre class="code"><code>
public static bool TryConsume(Consumer consumer, out Sutemeny? sutemeny)
{
    // Kiegészitendő
    lock (sutemenyek)
    {
        sutemeny = sutemenyek.FirstOrDefault(s =>
            s.SutemenyFajta == consumer.fogyasztottSutemenyFajta &&
            s.Toltelek == consumer.fogyasztottToltelek);

        if (sutemeny == null)
            return false;

        sutemenyek.Remove(sutemeny);
        return true;
    }
}
  </code></pre>
      </div>

      <div class="codebox">
        <div class="code-title">Supervisor.cs – TryConsume</div>
        <pre class="code"><code>
public static bool TryConsume(Consumer consumer, out Sutemeny? sutemeny)
{
    // Kiegészitendő
    lock (sutemenyek)
    {
        sutemeny = sutemenyek.FirstOrDefault(s =>
            s.SutemenyFajta == consumer.fogyasztottSutemenyFajta &&
            s.Toltelek == consumer.fogyasztottToltelek);

        if (sutemeny == null)
            return false;

        sutemenyek.Remove(sutemeny);
        return true;
    }
}
  </code></pre>
      </div>

      <div class="codebox">
        <div class="code-title">Supervisor.cs – Working state</div>
        <pre class="code"><code>
public static void CheckProducerWorkingState()
{
    // Kiegészitendő
    areProducersRunning = producers.Any(p => p.IsWorking);
}

public static void CheckConsumerWorkingState()
{
    // Kiegészitendő
    areConsumersRunning = consumers.Any(c => c.IsWorking);
}
  </code></pre>
      </div>

      <div class="codebox">
        <div class="code-title">Supervisor.cs – WriteOutOneStack</div>
        <pre class="code"><code>
public static void WriteOutOneStack()
{
    // Kiegészitendő
    if (csomagoltSutemenyek.TryTake(out var csomag))
    {
        Console.WriteLine("Csomag tartalma:");
        foreach (var s in csomag)
            Console.WriteLine(s);
    }
}
  </code></pre>
      </div>

      <div class="codebox">
        <div class="code-title">Supervisor.cs – Create methods</div>
        <pre class="code"><code>
public static void CreateConsumers(int amount, SutemenyFajta sutemenyFajta, Toltelek toltelek)
{
    // Kiegészitendő
    for (int i = 0; i < amount; i++)
        consumers.Add(new Consumer(sutemenyFajta, toltelek));
}

public static void CreateProducers(int amount, int amountToProduce, SutemenyFajta sutemenyFajta, Toltelek toltelek)
{
    // Kiegészitendő
    for (int i = 0; i < amount; i++)
        producers.Add(new Producer(amountToProduce, sutemenyFajta, toltelek));
}
  </code></pre>
      </div>

      <div class="codebox">
        <div class="code-title">Supervisor.cs – StartProcess</div>
        <pre class="code"><code>
public static void StartProcess()
{
    // Kiegészitendő
    maxSutemenyAPufferben = 10;
    csomagolasiMennyiseg = 8;

    areProducersRunning = true;
    areConsumersRunning = true;

    foreach (var p in producers)
    {
        Thread t = new Thread(p.Work);
        producerConsumerThreads.Add(t);
        t.Start();
    }

    foreach (var c in consumers)
    {
        Thread t = new Thread(c.Work);
        producerConsumerThreads.Add(t);
        t.Start();
    }
}
  </code></pre>
      </div>

      <div class="codebox">
        <div class="code-title">Program.cs</div>
        <pre class="code"><code>
static void Main(string[] args)
{
    // Termelők és fogyasztók létrehozása
    Supervisor.CreateProducers(2, 16, SutemenyFajta.bukta, Toltelek.makos);
    Supervisor.CreateConsumers(1, SutemenyFajta.bukta, Toltelek.makos);

    Supervisor.StartProcess();

    // Fő szál várakoztatása a folyamatok befejezéséig
    Console.ReadLine();
}
  </code></pre>
      </div>
    </div>
    <script>
      document.querySelectorAll("pre.code code").forEach((codeEl) => {
        let html = codeEl.textContent
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");

        html = html.replace(/(\/\/.*)/g, '<span class="cmt">$1</span>');
        html = html.replace(/(".*?")/g, '<span class="str">$1</span>');
        html = html.replace(/\b(\d+)\b/g, '<span class="num">$1</span>');
        html = html.replace(
          /\b(static|void|class|public|private|internal|return|new)\b/g,
          '<span class="kw">$1</span>'
        );
        html = html.replace(
          /\b(Console|Supervisor|SutemenyFajta|Toltelek)\b/g,
          '<span class="cls">$1</span>'
        );
        html = html.replace(
          /\b(Main|ReadLine|CreateProducers|CreateConsumers|StartProcess)\b/g,
          '<span class="mtd">$1</span>'
        );

        codeEl.innerHTML = html;
      });
    </script>
  </body>
</html>
